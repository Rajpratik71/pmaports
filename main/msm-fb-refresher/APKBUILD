pkgname=msm-fb-refresher
pkgver=0.2
pkgrel=0
pkgdesc="Display refresher for Qualcomm devices"
arch="all"
url="https://github.com/AsteroidOS/msm-fb-refresher"
license="GPL2"
makedepends="linux-headers"
install="$pkgname.post-install"
source="
	${pkgname}-${pkgver}.tar.gz::https://github.com/AsteroidOS/msm-fb-refresher/archive/v${pkgver}.tar.gz
	msm-fb-refresher.init
	00-msm-fb-refresher.sh
	00-msm-fb-refresher.files
"
builddir="${srcdir}/${pkgname}-${pkgver}"

build() {
	gcc refresher.c -o refresher.o -c
	gcc refresher.o -o msm-fb-refresher
}

package() {
	install -Dm755 "${builddir}/msm-fb-refresher" \
		"${pkgdir}/usr/sbin/msm-fb-refresher"
	install -Dm755 "${srcdir}/msm-fb-refresher.init" \
		"${pkgdir}/etc/init.d/msm-fb-refresher"

	# Initramfs hook
	local initfsdir="$pkgdir/etc/postmarketos-mkinitfs/"
	mkdir -p "$initfsdir/hooks" "$initfsdir/files"
	install -Dm755 "$srcdir/00-msm-fb-refresher.sh" \
		"$initfsdir/hooks/00-msm-fb-refersher.sh"
	install -Dm755 "$srcdir/00-msm-fb-refresher.files" \
		"$initfsdir/files/00-msm-fb-refersher.files"
}
sha512sums="5e2920cf86f2e373e2411a89cf3ac6745af042ff7d91ae581f26b72772bc9ab621ea4154bc33ef57dce0c04ba3f88ee3b9f98c2a17b2579df368b0929cf0bfa7  msm-fb-refresher-0.2.tar.gz
5820e02dcb1cd927bcd6c8548307936a12f0dde1b92f15a931134b8d4a41f4b5e8811c6969d9b11a6a31d40da218b24ee274614936f6e50bcd6e794346f99c13  msm-fb-refresher.init
1b6168037293db465a5a55d5c263cb60ac46cccb601329b193110bbdffc23207b3d38419d2ad128020bf4ddbcdb868e8fa2f561764adf02c7db0526b0177ee5a  00-msm-fb-refresher.sh
906c0d672682a9f0e3e8e07e207a557b8a1659e2e6021cb95c4b9886aed3b9ea477638c00ce9e4193b52dcfab7da317d9840cc576f29c7c7158cc11fd368be84  00-msm-fb-refresher.files"
